{% extends "base.html" %}
{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function () {
  document.querySelectorAll('.utc-datetime').forEach(el => {
    const raw = (el.dataset.utc || el.textContent || '').trim();
    if (!raw || raw === '---') return;
    // Utnij ułamki sekund (np. .536000), żeby Date nie wywalił parsowania
    const cleaned = raw.split('.')[0];
    el.textContent = formatUTCDateToLocal(cleaned);
  });
});
</script>
{% endblock %}
{% block title %}Historia Alarmów - System MES{% endblock %}

{% block content %}
<h1 class="mb-4">Historia Alarmów</h1>

<table class="table table-striped table-hover">
    <thead class="table-dark">
        <tr>
            <th>ID</th>
            <th>Typ</th>
            <th>Sprzęt</th>
            <th>Wartość</th>
            <th>Limit</th>
            <th>Czas Wystąpienia</th>
            <th>Czas Zakończenia</th>
            <th>Status</th>
        </tr>
    </thead>
    <tbody>
        {% for alarm in alarms %}
        <tr class="{% if alarm.status_alarmu == 'AKTYWNY' %}table-danger{% elif alarm.status_alarmu == 'ZAKOŃCZONY' %}table-success{% endif %}">
            <td>{{ alarm.id }}</td>
            <td>{{ alarm.typ_alarmu }}</td>
            <td>{{ alarm.nazwa_sprzetu }}</td>
            <td>{{ alarm.wartosc }}</td>
            <td>{{ alarm.limit_przekroczenia }}</td>
            <td class="utc-datetime" data-utc="{{ alarm.czas_wystapienia.isoformat() }}">{{ alarm.czas_wystapienia.isoformat() }}</td>
            <td class="utc-datetime" data-utc="{{ alarm.czas_zakonczenia.isoformat() if alarm.czas_zakonczenia else '---' }}">{{ alarm.czas_zakonczenia.isoformat() if alarm.czas_zakonczenia else '---' }}</td>
            <td>{{ alarm.status_alarmu }}</td>
        </tr>
        {% else %}
        <tr>
            <td colspan="8" class="text-center">Brak alarmów w historii.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}